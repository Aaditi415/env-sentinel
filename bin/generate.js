#!/usr/bin/env node
import fs from "fs";
import path from "path";
import { pathToFileURL } from "url";

const schemaPath = path.resolve(process.cwd(), "schema.js");

async function generate() {
  try {
    const { schema } = await import(pathToFileURL(schemaPath));

    let content = "# Auto-generated by ENV Guard\n\n";

    for (const key in schema) {
      const rule = schema[key];
      const description = rule.description ? `# ${rule.description}\n` : "";
      const defaultVal = rule.default !== undefined ? rule.default : "";
      content += `${description}${key}=${defaultVal}\n\n`;
    }

    const outPath = path.resolve(process.cwd(), ".env.example");
    fs.writeFileSync(outPath, content.trim() + "\n", "utf-8");

    console.log(`‚úÖ .env.example generated successfully!`);
  } catch (err) {
    console.error("‚ùå Could not find schema.js in project root.");
    console.error("üëâ Please create schema.js to define your environment variables.");
    process.exit(1);
  }
}

generate();
